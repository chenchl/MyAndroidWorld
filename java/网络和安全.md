## 网络和安全

### 网络

#### TCP和UDP

| 区别点   | TCP                                           | UDP                     |
| -------- | --------------------------------------------- | ----------------------- |
| 连接性   | 面向连接                                      | 无连接                  |
| 可靠性   | 可靠                                          | 不可靠                  |
| 有序性   | 有序                                          | 无序                    |
| 结构     | 字节流                                        | 报文                    |
| 流量控制 | 有（滑动窗口）                                | 无                      |
| 拥塞控制 | 有（慢开始、拥塞避免、快重传、快恢复）        | 无                      |
| 速度     | 慢                                            | 快                      |
| head大小 | 大（20~60byte）                               | 小（8byte）             |
| 双工性   | 全双工                                        | 1对1 1对多 多对1 多对多 |
| 应用场景 | 文件传输 接口访问 邮件传输 浏览器http访问等等 | 即时通话 直播等         |

##### tcp头结构

![tcp头](https://img-blog.csdn.net/20180811081238887?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3plcWkxOTkx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

##### udp头结构

![UDP头结构](https://img-blog.csdn.net/20180517222301867?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0FTSkJGSlNC/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

##### TCP三次握手

![三次握手](http://blog.chinaunix.net/attachment/201304/8/22312037_1365405910EROI.png)

1. 第一次握手：Client将标志位SYN置为1，随机产生一个值seq=J，并将该数据包发送给Server，Client进入SYN_SENT状态，等待Server确认。
2. 第二次握手：Server收到数据包后由标志位SYN=1知道Client请求建立连接，Server将标志位SYN和ACK都置为1，ack=J+1，随机产生一个值seq=K，并将该数据包发送给Client以确认连接请求，Server进入SYN_RCVD状态。
3. 第三次握手：Client收到确认后，检查ack是否为J+1，ACK是否为1，如果正确则将标志位ACK置为1，ack=K+1，并将该数据包发送给Server，Server检查ack是否为K+1，ACK是否为1，如果正确则连接建立成功，Client和Server进入ESTABLISHED状态，完成三次握手，随后Client与Server之间可以开始传输数据了。

   *三次握手的目的是为了避免当服务端发出响应后可能由于网络原因导致客户端收不到响应造成的服务端资源浪费 



##### TCP四次挥手

![四次挥手](http://blog.chinaunix.net/attachment/201304/9/22312037_1365503104wDR0.png)

1. 第一次挥手：Client发送一个FIN，用来关闭Client到Server的数据传送，Client进入FIN_WAIT_1状态。
2. 第二次挥手：Server收到FIN后，发送一个ACK给Client，确认序号为收到序号+1（与SYN相同，一个FIN占用一个序号），Server进入CLOSE_WAIT状态。
3. 第三次挥手：Server发送一个FIN，用来关闭Server到Client的数据传送，Server进入LAST_ACK状态。
4. 第四次挥手：Client收到FIN后，Client进入TIME_WAIT状态，接着发送一个ACK给Server，确认序号为收到序号+1，Server进入CLOSED状态，完成四次挥手。

   *四次挥手的原因是因为TCP连接是全双工的，因此，每个方向都必须要单独进行关闭，这一原则是当一方完成数据发送任务后，发送一个FIN来终止这一方向的连接，收到一个FIN只是意味着这一方向上没有数据流动了，即不会再收到数据了，但是在这个TCP连接上仍然能够发送数据，直到这一方向也发送了FIN。确保双方都不再有数据需要发送了